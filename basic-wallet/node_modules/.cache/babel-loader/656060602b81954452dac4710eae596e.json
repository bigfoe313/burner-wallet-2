{"ast":null,"code":"var _regeneratorRuntime = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _defineProperty = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _asyncToGenerator = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/home/aforbers/burner-wallet-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar Gateway = require('./Gateway');\n\nvar Web3 = require('web3');\n\nvar tabookey = require('@dmihal/tabookey-gasless');\n\nvar GSNGateway =\n/*#__PURE__*/\nfunction (_Gateway) {\n  \"use strict\";\n\n  _inherits(GSNGateway, _Gateway);\n\n  function GSNGateway() {\n    var _this;\n\n    _classCallCheck(this, GSNGateway);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GSNGateway).call(this, ['1', '3', '4', '5', '42', '100']));\n    _this.isOn = true;\n    _this._w3Provider = null;\n    _this.clients = {};\n    return _this;\n  }\n\n  _createClass(GSNGateway, [{\n    key: \"isAvailable\",\n    value: function isAvailable() {\n      return this.isOn;\n    }\n  }, {\n    key: \"getClient\",\n    value: function getClient(network) {\n      if (!this.clients[network]) {\n        this.clients[network] = new tabookey.RelayClient(this.core.getWeb3(network), {});\n      }\n\n      return this.clients[network];\n    }\n  }, {\n    key: \"sendTx\",\n    value: function () {\n      var _sendTx = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(network, payload) {\n        var client;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!payload.params[0].useGSN) {\n                  _context.next = 3;\n                  break;\n                }\n\n                client = this.getClient(network);\n                return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  client.runRelay(_objectSpread({}, payload, {\n                    method: 'eth_sendTransaction'\n                  }), function (err, result) {\n                    if (err) {\n                      return reject(err);\n                    }\n\n                    resolve(result.result);\n                  });\n                }));\n\n              case 3:\n                return _context.abrupt(\"return\", this.send(network, _objectSpread({}, payload, {\n                  params: [payload.params[0].signedTransaction]\n                })));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function sendTx(_x, _x2) {\n        return _sendTx.apply(this, arguments);\n      }\n\n      return sendTx;\n    }()\n  }, {\n    key: \"send\",\n    value: function () {\n      var _send = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(network, payload) {\n        var request, response;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                this.isOn = false;\n                request = this.core.handleRequest(network, payload);\n                this.isOn = true;\n                _context2.next = 6;\n                return request;\n\n              case 6:\n                response = _context2.sent;\n\n                if (payload.method === 'eth_getTransactionReceipt' && response) {\n                  this.getClient(network).fixTransactionReceiptResp(response.result);\n                }\n\n                return _context2.abrupt(\"return\", response);\n\n              case 11:\n                _context2.prev = 11;\n                _context2.t0 = _context2[\"catch\"](0);\n                this.isOn = true;\n                throw _context2.t0;\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 11]]);\n      }));\n\n      function send(_x3, _x4) {\n        return _send.apply(this, arguments);\n      }\n\n      return send;\n    }()\n  }]);\n\n  return GSNGateway;\n}(Gateway);\n\nmodule.exports = GSNGateway;","map":null,"metadata":{},"sourceType":"script"}